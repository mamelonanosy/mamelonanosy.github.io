<!DOCTYPE html>
<html>
<head>
    <title>Proofs</title>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
    <style>
        .container {
            display: flex;
            flex-direction: column;
        }

        .group {
            margin-bottom: 10px;
        }

        .subgroup {
            margin-left: 20px;
            margin-top: 5px;
        }
    </style>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyC9c6EBb1hf-yg_sm9V4EWsAbqMYg_frH8",
            authDomain: "posiposy-97cc9.firebaseapp.com",
            databaseURL: "https://posiposy-97cc9-default-rtdb.firebaseio.com",
            projectId: "posiposy-97cc9",
            storageBucket: "posiposy-97cc9.appspot.com",
            messagingSenderId: "649865269147",
            appId: "1:649865269147:web:ce8be5a5c9cdd22eb61b3e"
        };
        firebase.initializeApp(firebaseConfig);
    </script>
</head>
<body>
    <div class="container" id="groupContainer">
        <div class="group">
            <button onclick="addGroup()">Add Group</button>
        </div>
    </div>

    <script>
        var db = firebase.database();

        window.onload = function() {
            var ref = db.ref('tasks');
            ref.once('value', function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    createGroup(childSnapshot);
                });
            });
        }

        function createGroup(childSnapshot) {
            var childKey = childSnapshot.key;
            var childData = childSnapshot.val();

            var groupDiv = document.createElement("div");
            groupDiv.className = "group";
            var groupButton = document.createElement("button");
            groupButton.innerHTML = childData.name || childKey;
            groupDiv.appendChild(groupButton);

            var editButton = document.createElement("button");
            editButton.innerHTML = "Edit";
            editButton.onclick = function() { editGroup(groupButton, childKey, groupDiv); };
            groupDiv.appendChild(editButton);

            var deleteButton = document.createElement("button");
            deleteButton.innerHTML = "Delete";
            deleteButton.onclick = function() { deleteGroup(groupDiv, childKey); };
            groupDiv.appendChild(deleteButton);

            var doneButton = document.createElement("button");
            doneButton.innerHTML = "Done";
doneButton.onclick = function() {
markGroupAsDone(childKey, groupButton, doneButton);
};
groupDiv.appendChild(doneButton);
            
        document.getElementById("groupContainer").appendChild(groupDiv);

        childSnapshot.forEach(function(subgroupSnapshot) {
            var subgroupKey = subgroupSnapshot.key;
            var subgroupData = subgroupSnapshot.val();
            if (subgroupKey !== 'name') {
                var subgroupDiv = document.createElement("div");
                subgroupDiv.className = "subgroup";
                subgroupDiv.innerHTML = subgroupKey + ":<br>" + Object.entries(subgroupData).map(([key, value]) => `${key}: ${value}`).join('<br>');
                groupDiv.appendChild(subgroupDiv);
            }
        });
    }

    function addGroup() {
        var groupName = prompt("Please enter the group name:");
        if (groupName != null) {
            var newRef = db.ref('tasks').push();
            newRef.set({name: groupName});
        }
    }

    function editGroup(button, childKey, groupDiv) {
        var newName = prompt("Please enter the new group name:");
        if (newName != null) {
            var groupRef = db.ref('tasks/' + childKey);
            groupRef.update({name: newName});
            button.innerHTML = newName;
        }
    }

    function deleteGroup(groupDiv, childKey) {
        if (confirm("Are you sure you want to delete this group?")) {
            var groupRef = db.ref('tasks/' + childKey);
            groupRef.remove();
            groupDiv.remove();
        }
    }

    function markGroupAsDone(childKey, button, doneButton) {
        var groupRef = db.ref('tasks/' + childKey + '/name');
        groupRef.once('value', function(snapshot) {
            var groupName = snapshot.val();
            var displayGroupName = groupName + ' âœ…';
            button.innerHTML = displayGroupName;
            doneButton.style.display = 'none';
        });
    }
</script>

<button id="deleteAllButton" style="color: red; text-transform: uppercase;" onclick="deleteAll()">Delete All</button>

<script>
    function deleteAll() {
        if (confirm("Are you sure you want to delete all data?")) {
            db.ref('tasks').remove();
            document.getElementById("groupContainer").innerHTML = '<div class="group"><button onclick="addGroup()">Add Group</button></div>';
        }
    }
</script>
